<!--adventure.wxml-->
<view class="page">
  <!-- æ¸¸æˆå¤´éƒ¨ä¿¡æ¯ -->
  <view class="game-header">
    <view class="game-info">
      <view class="level-info">å…³å¡ {{currentLevel}}</view>
      <view class="score-info">åˆ†æ•°: {{score}}</view>
    </view>
    <view class="game-stats">
      <view class="stat-item">
        <text class="stat-icon">â¤ï¸</text>
        <text class="stat-value">{{lives}}</text>
      </view>
      <view class="stat-item">
        <text class="stat-icon">ğŸ’°</text>
        <text class="stat-value">{{coins}}</text>
      </view>
    </view>
  </view>

  <!-- æ¸¸æˆçŠ¶æ€ -->
  <view class="game-status" wx:if="{{gameStatus === 'ready'}}">
    <view class="status-content">
      <view class="status-icon">ğŸ—¡ï¸</view>
      <view class="status-title">å†’é™©æ¨¡å¼</view>
      <view class="status-desc">å‡†å¤‡å¼€å§‹ä½ çš„å•è¯å†’é™©ä¹‹æ—…ï¼</view>
      <button class="btn btn-primary" bindtap="startGame">å¼€å§‹æ¸¸æˆ</button>
    </view>
  </view>

  <!-- æ¸¸æˆè¿›è¡Œä¸­ -->
  <view class="game-playing" wx:if="{{gameStatus === 'playing'}}">
    <!-- å½“å‰å•è¯ -->
    <view class="word-display">
      <view class="word-english">{{currentWord.english}}</view>
      <view class="word-pronunciation" wx:if="{{currentWord.pronunciation}}">
        {{currentWord.pronunciation}}
      </view>
    </view>

    <!-- é€‰é¡¹ -->
    <view class="options-container">
      <view class="option-item" 
            wx:for="{{options}}" 
            wx:key="index"
            bindtap="selectOption"
            data-index="{{index}}"
            class="{{selectedIndex === index ? 'selected' : ''}} {{showResult && index === correctIndex ? 'correct' : ''}} {{showResult && selectedIndex === index && index !== correctIndex ? 'wrong' : ''}}">
        <view class="option-text">{{item}}</view>
      </view>
    </view>

    <!-- ä¸‹ä¸€é¢˜æŒ‰é’® -->
    <view class="next-button" wx:if="{{showResult}}">
      <button class="btn btn-primary btn-full" bindtap="nextQuestion">
        {{isLastQuestion ? 'å®Œæˆå…³å¡' : 'ä¸‹ä¸€é¢˜'}}
      </button>
    </view>

    <!-- è¿›åº¦æ¡ -->
    <view class="progress-container">
      <view class="progress-text">{{currentQuestionIndex + 1}} / {{totalQuestions}}</view>
      <view class="progress-bar">
        <view class="progress-fill" style="width: {{progressPercent}}%"></view>
      </view>
    </view>
  </view>

  <!-- æ¸¸æˆç»“æŸ -->
  <view class="game-over" wx:if="{{gameStatus === 'finished'}}">
    <view class="result-content">
      <view class="result-icon">{{gameResult.success ? 'ğŸ‰' : 'ğŸ˜¢'}}</view>
      <view class="result-title">
        {{gameResult.success ? 'å…³å¡å®Œæˆï¼' : 'æ¸¸æˆç»“æŸ'}}
      </view>
      <view class="result-stats">
        <view class="result-item">
          <view class="result-label">æœ€ç»ˆåˆ†æ•°</view>
          <view class="result-value">{{score}}</view>
        </view>
        <view class="result-item">
          <view class="result-label">æ­£ç¡®ç‡</view>
          <view class="result-value">{{accuracy}}%</view>
        </view>
        <view class="result-item">
          <view class="result-label">è·å¾—é‡‘å¸</view>
          <view class="result-value">+{{earnedCoins}}</view>
        </view>
        <view class="result-item" wx:if="{{earnedExp}}">
          <view class="result-label">è·å¾—ç»éªŒ</view>
          <view class="result-value">+{{earnedExp}}</view>
        </view>
      </view>
      <view class="result-actions">
        <button class="btn btn-outline" bindtap="restartGame">é‡æ–°å¼€å§‹</button>
        <button class="btn btn-primary" bindtap="nextLevel" wx:if="{{gameResult.success && hasNextLevel}}">
          ä¸‹ä¸€å…³å¡
        </button>
        <button class="btn btn-secondary" bindtap="backToGames">è¿”å›æ¸¸æˆ</button>
      </view>
    </view>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading" wx:if="{{isLoading}}">
    <view class="loading-icon">ğŸ”„</view>
    <view class="loading-text">åŠ è½½ä¸­...</view>
  </view>
</view>
