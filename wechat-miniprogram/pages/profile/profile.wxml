<!--profile.wxml-->
<view class="page">
  <!-- ç”¨æˆ·ä¿¡æ¯å¤´éƒ¨ -->
  <view class="profile-header" wx:if="{{userInfo}}">
    <view class="avatar">{{userInfo.username.charAt(0).toUpperCase()}}</view>
    <view class="user-info">
      <view class="username">{{userInfo.username}}</view>
      <view class="user-email">{{userInfo.email}}</view>
      <view class="user-level">
        <text class="level-text">Lv.{{userInfo.level}}</text>
        <view class="exp-bar">
          <view class="exp-fill" style="width: {{expProgress}}%"></view>
        </view>
        <text class="exp-text">{{userInfo.experience}}/{{nextLevelExp}}</text>
      </view>
    </view>
  </view>

  <!-- ç™»å½•æç¤º -->
  <view class="login-prompt" wx:if="{{!userInfo}}">
    <view class="prompt-icon">ğŸ‘¤</view>
    <view class="prompt-title">è¯·å…ˆç™»å½•</view>
    <view class="prompt-desc">ç™»å½•åæŸ¥çœ‹ä¸ªäººèµ„æ–™å’Œå­¦ä¹ è¿›åº¦</view>
    <button class="btn btn-primary" bindtap="goToLogin">ç«‹å³ç™»å½•</button>
  </view>

  <!-- ç”¨æˆ·ç»Ÿè®¡ -->
  <view class="stats-section" wx:if="{{userInfo}}">
    <view class="stats-grid">
      <view class="stat-card">
        <view class="stat-icon">ğŸ’°</view>
        <view class="stat-value">{{userInfo.coins}}</view>
        <view class="stat-label">é‡‘å¸</view>
      </view>
      <view class="stat-card">
        <view class="stat-icon">ğŸ¯</view>
        <view class="stat-value">{{achievements.length}}</view>
        <view class="stat-label">æˆå°±</view>
      </view>
      <view class="stat-card">
        <view class="stat-icon">ğŸ”¥</view>
        <view class="stat-value">{{streak}}</view>
        <view class="stat-label">è¿ç»­å¤©æ•°</view>
      </view>
      <view class="stat-card">
        <view class="stat-icon">ğŸ“ˆ</view>
        <view class="stat-value">{{rank}}</view>
        <view class="stat-label">æ’å</view>
      </view>
    </view>
  </view>

  <!-- æœ€è¿‘æˆå°± -->
  <view class="card" wx:if="{{userInfo && achievements.length > 0}}">
    <view class="card-title">ğŸ† æœ€è¿‘æˆå°±</view>
    <view class="achievement-list">
      <view class="achievement-item" wx:for="{{achievements}}" wx:key="id" wx:if="{{index < 3}}">
        <view class="achievement-icon">{{item.icon}}</view>
        <view class="achievement-info">
          <view class="achievement-name">{{item.name}}</view>
          <view class="achievement-desc">{{item.description}}</view>
          <view class="achievement-date">{{item.earnedAt}}</view>
        </view>
      </view>
    </view>
    <view class="view-all" bindtap="viewAllAchievements">æŸ¥çœ‹å…¨éƒ¨æˆå°± ></view>
  </view>

  <!-- å­¦ä¹ åå¥½ -->
  <view class="card" wx:if="{{userInfo}}">
    <view class="card-title">âš™ï¸ å­¦ä¹ åå¥½</view>
    <view class="preference-list">
      <view class="preference-item">
        <view class="preference-label">åå¥½åˆ†ç±»</view>
        <picker bindchange="onCategoryChange" value="{{categoryIndex}}" range="{{categories}}">
          <view class="preference-value">{{categories[categoryIndex] || 'è¯·é€‰æ‹©'}}</view>
        </picker>
      </view>
      <view class="preference-item">
        <view class="preference-label">å­¦ä¹ æé†’</view>
        <switch checked="{{reminderEnabled}}" bindchange="onReminderChange" color="#4F46E5"/>
      </view>
      <view class="preference-item">
        <view class="preference-label">éŸ³æ•ˆå¼€å…³</view>
        <switch checked="{{soundEnabled}}" bindchange="onSoundChange" color="#4F46E5"/>
      </view>
    </view>
  </view>

  <!-- åŠŸèƒ½èœå• -->
  <view class="menu-section" wx:if="{{userInfo}}">
    <view class="menu-item" bindtap="viewAchievements">
      <view class="menu-icon">ğŸ†</view>
      <view class="menu-text">æˆ‘çš„æˆå°±</view>
      <view class="menu-arrow">></view>
    </view>
    <view class="menu-item" bindtap="viewHistory">
      <view class="menu-icon">ğŸ“Š</view>
      <view class="menu-text">å­¦ä¹ å†å²</view>
      <view class="menu-arrow">></view>
    </view>
    <view class="menu-item" bindtap="viewSettings">
      <view class="menu-icon">âš™ï¸</view>
      <view class="menu-text">è®¾ç½®</view>
      <view class="menu-arrow">></view>
    </view>
    <view class="menu-item" bindtap="contactSupport">
      <view class="menu-icon">ğŸ’¬</view>
      <view class="menu-text">è”ç³»å®¢æœ</view>
      <view class="menu-arrow">></view>
    </view>
    <view class="menu-item" bindtap="showAbout">
      <view class="menu-icon">â„¹ï¸</view>
      <view class="menu-text">å…³äºæˆ‘ä»¬</view>
      <view class="menu-arrow">></view>
    </view>
  </view>

  <!-- é€€å‡ºç™»å½• -->
  <view class="logout-section" wx:if="{{userInfo}}">
    <button class="btn btn-outline btn-full" bindtap="handleLogout">é€€å‡ºç™»å½•</button>
  </view>
</view>
